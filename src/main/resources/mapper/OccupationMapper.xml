<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qingming.jobserver.mapper.OccupationMapper">
    
    <resultMap id="BaseResultMap" type="com.qingming.jobserver.model.entity.Occupation">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="categoryId" column="category_id"/>
        <result property="icon" column="icon"/>
        <result property="description" column="description"/>
        <result property="requiredCertificates" column="required_certificates" typeHandler="com.baomidou.mybatisplus.extension.handlers.JacksonTypeHandler"/>
        <result property="averageDailyWage" column="average_daily_wage"/>
        <result property="difficultyLevel" column="difficulty_level"/>
        <result property="status" column="status"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>
    
    <resultMap id="OccupationWithCategoryMap" type="com.qingming.jobserver.model.entity.Occupation">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="categoryId" column="category_id"/>
        <result property="icon" column="icon"/>
        <result property="description" column="description"/>
        <result property="requiredCertificates" column="required_certificates" typeHandler="com.baomidou.mybatisplus.extension.handlers.JacksonTypeHandler"/>
        <result property="averageDailyWage" column="average_daily_wage"/>
        <result property="difficultyLevel" column="difficulty_level"/>
        <result property="status" column="status"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="categoryName" column="category_name"/>
    </resultMap>
    
    <!-- 根据名称查询工种 -->
    <select id="selectByName" resultMap="BaseResultMap">
        SELECT *
        FROM occupation
        WHERE name = #{name}
        LIMIT 1
    </select>
    
    <!-- 根据类别ID查询工种列表 -->
    <select id="selectByCategoryId" resultMap="BaseResultMap">
        SELECT *
        FROM occupation
        WHERE category_id = #{categoryId}
    </select>
    
    <!-- 分页查询工种并关联类别信息 -->
    <select id="selectPageWithCategory" resultMap="OccupationWithCategoryMap">
        SELECT o.*, c.name as category_name
        FROM occupation o
        LEFT JOIN occupation_category c ON o.category_id = c.id
        <where>
            <if test="categoryId != null">
                o.category_id = #{categoryId}
            </if>
        </where>
    </select>
    
    <!-- 根据ID查询工种（含类别名称） -->
    <select id="selectByIdWithCategory" resultMap="OccupationWithCategoryMap">
        SELECT o.*, c.name as category_name
        FROM occupation o
        LEFT JOIN occupation_category c ON o.category_id = c.id
        WHERE o.id = #{id}
    </select>
</mapper>